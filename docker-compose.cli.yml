# Baklib CLI：配置 / 安装 / 导入主题 等命令
# 使用已发布的 CLI 镜像（BAKLIB_CLI_IMAGE），不本地构建，避免国内环境拉取 debian/apt 源失败。
# 用法示例：
#   docker compose -f docker-compose.cli.yml run --rm config
#   docker compose -f docker-compose.cli.yml run --rm install
#   docker compose -f docker-compose.cli.yml run --rm import-themes [--skip-clone|--clone-only]
# 启动/停止/重启主栈仍在项目目录执行：
#   docker compose up -d
#   docker compose stop
#   docker compose restart

services:
  config:
    image: ${BAKLIB_CLI_IMAGE:-registry.devops.tanmer.com/library/baklib-cli:latest}
    container_name: baklib-cli-config
    stdin_open: true
    tty: true
    init: true
    working_dir: /work
    volumes:
      - .:/work
    command: ["bash", "./scripts/config.sh"]

  install:
    image: ${BAKLIB_CLI_IMAGE:-registry.devops.tanmer.com/library/baklib-cli:latest}
    container_name: baklib-cli-install
    stdin_open: true
    tty: true
    init: true
    working_dir: /work
    volumes:
      - .:/work
      - /var/run/docker.sock:/var/run/docker.sock
    command: ["bash", "./scripts/install.sh"]

  import-themes:
    image: ${BAKLIB_CLI_IMAGE:-registry.devops.tanmer.com/library/baklib-cli:latest}
    container_name: baklib-cli-import-themes
    stdin_open: true
    tty: true
    init: true
    working_dir: /work
    volumes:
      - .:/work
      - /var/run/docker.sock:/var/run/docker.sock
    command: ["bash", "./scripts/import-themes.sh"]

  clean:
    image: ${BAKLIB_CLI_IMAGE:-registry.devops.tanmer.com/library/baklib-cli:latest}
    container_name: baklib-cli-clean
    stdin_open: true
    tty: true
    init: true
    working_dir: /work
    volumes:
      - .:/work
      - /var/run/docker.sock:/var/run/docker.sock
    command: ["bash", "./scripts/clean.sh"]
